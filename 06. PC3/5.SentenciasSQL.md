# Sentencias SQL por cada Prototipo

## Gestión de Pedidos

### Visualización de Pedidos de Migración

---

**Código Requerimiento:** R-010, R-011

**Código Interfaz:** I-010

**Imagen Interfaz**

<div>
<img src=".\resources\prototipo\I-010.jpeg" alt="I-010" style="width: 50%; height: auto;"/>
</div>

**Sentencias SQL**

**Eventos:**

1. **Carga de Página:**

    Se llenará la primera tabla:
    ```sql
    SELECT 
        p."Pedido_Id" AS "Pedido",
        a."Area_Nombre" AS "Área Solicitante",
        e."Estado_Tipo" AS "Estado",
        pr."Prioridad_Tipo" AS "Prioridad",
        p."Pedido_Fecha" AS "Fecha del Pedido", 
        p."Pedido_FechaLimite" AS "Fecha Límite"
    FROM public."Pedido" p
    INNER JOIN public."Area" a ON a."Area_Id" = p."Area_Id"
    INNER JOIN public."Estado" e ON e."Estado_Id" = p."Estado_Id"
    INNER JOIN public."Prioridad" pr ON p."Prioridad_Id" = p."Prioridad_Id"
    ORDER BY p."Pedido_FechaLimite" DESC
    LIMIT 3;
    ```

    Se llenará la segunda tabla:
    ```sql
    SELECT
        m."Migracion_Id" AS "Migración",
        m."Pedido_Id" AS "Pedido",
        s.nombre_squad AS "Squad Encargado", 
        t.nombre_tecnologia AS "Tecnología Usada",
        m."Fecha_migracion" AS "Fecha"
    FROM public."Migracion" m
    INNER JOIN public."Squad" s ON s.id_squad = m."Id_Squad"
    INNER JOIN public."Tecnologia" t ON t.id_tecnologia = m."Id_Tecnologia"
    ORDER BY m."Fecha_migracion" DESC
    LIMIT 3;
    ```

---

**Código Requerimiento:** R-010

**Código Interfaz:** I-011

**Imagen Interfaz**

<div>
<img src=".\resources\prototipo\I-011.jpeg" alt="I-011" style="width: 50%; height: auto;"/>
</div>

**Sentencias SQL**

**Eventos:**

1. **Carga de Página:**

    Se llenará la tabla:
    ```sql
    SELECT 
        p."Pedido_Id" AS "Pedido",
        a."Area_Nombre" AS "Área Solicitante",
        e."Estado_Tipo" AS "Estado",
        pr."Prioridad_Tipo" AS "Prioridad",
        p."Pedido_Fecha" AS "Fecha del Pedido", 
        p."Pedido_FechaLimite" AS "Fecha Límite"
    FROM public."Pedido" p
    INNER JOIN public."Area" a ON a."Area_Id" = p."Area_Id"
    INNER JOIN public."Estado" e ON e."Estado_Id" = p."Estado_Id"
    INNER JOIN public."Prioridad" pr ON p."Prioridad_Id" = p."Prioridad_Id"
    ORDER BY p."Pedido_FechaLimite" DESC;
    ```

---

**Código Requerimiento:** R-010

**Código Interfaz:** I-011

**Imagen Interfaz**

<div>
<img src=".\resources\prototipo\I-011.jpeg" alt="I-011" style="width: 50%; height: auto;"/>
</div>

**Sentencias SQL**

**Eventos:**

1. **Carga de Página:**
    Se llenará la tabla:
    ```sql
    SELECT 
        p."Pedido_Id" AS "Pedido",
        a."Area_Nombre" AS "Área Solicitante",
        e."Estado_Tipo" AS "Estado",
        pr."Prioridad_Tipo" AS "Prioridad",
        p."Pedido_Fecha" AS "Fecha del Pedido", 
        p."Pedido_FechaLimite" AS "Fecha Límite"
    FROM public."Pedido" p
    INNER JOIN public."Area" a ON a."Area_Id" = p."Area_Id"
    INNER JOIN public."Estado" e ON e."Estado_Id" = p."Estado_Id"
    INNER JOIN public."Prioridad" pr ON p."Prioridad_Id" = p."Prioridad_Id"
    ORDER BY p."Pedido_FechaLimite" DESC;
    ```

---

**Código Requerimiento:** R-010

**Código Interfaz:** I-012

**Imagen Interfaz**

<div>
<img src=".\resources\prototipo\I-012.jpeg" alt="I-012" style="width: 50%; height: auto;"/>
</div>

**Sentencias SQL**

**Eventos:**

1. **Carga de Página:**

    Se llenará la tabla:
    ```sql
    SELECT
        m."Pedido_Id" AS "Pedido",
        m."Migracion_Id" AS "Migración",
        s.nombre_squad AS "Squad Encargado", 
        t.nombre_tecnologia AS "Tecnología Usada",
        m."Fecha_migracion" AS "Fecha"
    FROM public."Migracion" m
    INNER JOIN public."Squad" s ON s.id_squad = m."Id_Squad"
    INNER JOIN public."Tecnologia" t ON t.id_tecnologia = m."Id_Tecnologia"
    ORDER BY m."Fecha_migracion";
    ```

    Se llenará la lista de pedidos a seleccionar:
    ```sql
    SELECT "Pedido_Id"
    FROM public."Pedido";
    ```

2. **Botón Buscar:**
    Cuando el usuario presione el botón buscar se filtrará la tabla por el pedido seleccionado:
    ```sql
    SELECT
        m."Migracion_Id" AS "Migración",
        m."Pedido_Id" AS "Pedido",
        s.nombre_squad AS "Squad Encargado", 
        t.nombre_tecnologia AS "Tecnología Usada",
        m."Fecha_migracion" AS "Fecha"
    FROM public."Migracion" m
    INNER JOIN public."Squad" s ON s.id_squad = m."Id_Squad"
    INNER JOIN public."Tecnologia" t ON t.id_tecnologia = m."Id_Tecnologia"
    WHERE m."Pedido_Id" = <1>
    ORDER BY m."Fecha_migracion";
    ```

    Donde `<1>` corresponde al código de pedido seleccionado.


### Adición de Pedidos y de Migraciones

---

**Código Requerimiento:** R-012

**Código Interfaz:** I-013

**Imagen Interfaz**

<div>
<img src=".\resources\prototipo\I-013.jpeg" alt="I-013" style="width: 50%; height: auto;"/>
</div>

**Sentencias SQL**

**Eventos:**

1. **Cargar Página:**

    Se llenará la lista de áreas a seleccionar:
    ```sql
    SELECT "Area_Id", "Area_Nombre" 
    FROM public."Area";
    ```

    Se llenará la lista de estados a seleccionar:
    ```sql
    SELECT "Estado_Id", "Estado_Tipo"
    FROM public."Estado";
    ```

    Se llenará la lista de prioridad a seleccionar:
    ```sql
    SELECT "Prioridad_Id", "Prioridad_Tipo" 
    FROM public."Prioridad";
    ```

2. **Botón Agregar:**
    Se agregará un nuevo registro a la tabla de pedidos.
    ```sql
    INSERT INTO public."Pedido"( "Area_Id", "Prioridad_Id", "Estado_Id", "Pedido_Fecha", "Pedido_FechaLimite")
        VALUES 
        (<1>, <2>, <3>, <4>, CURRENT_DATE);
    ```
    Donde `<1>` corresponde al código de área seleccionado.

    Donde `<2>` corresponde al código de estado seleccionado.

    Donde `<3>` corresponde al código de prioridad seleccionado.

    Donde `<4>` se capturarán de la interfaz de usuario.

---

**Código Requerimiento:** R-013

**Código Interfaz:** I-014

**Imagen Interfaz**

<div>
<img src=".\resources\prototipo\I-014.jpeg" alt="I-014" style="width: 50%; height: auto;"/>
</div>

**Sentencias SQL**

**Eventos:**

1. **Cargar Página:**

    Se llenará la lista de pedidos a seleccionar:
    ```sql
    SELECT "Pedido_Id"
    FROM public."Pedido";
    ```

    Se llenará la lista de squads a seleccionar:
    ```sql
    SELECT id_squad, nombre_squad 
    FROM public."Squad";
    ```

    Se llenará la lista de tecnologías a seleccionar:
    ```sql
    SELECT id_tecnologia, nombre_tecnologia 
    FROM public."Tecnologia";
    ```

2. **Botón Agregar:**

    Se agregará un nuevo registro a la tabla de pedidos.
    ```sql
    INSERT INTO public."Migracion"(
        "Pedido_Id", "Id_Squad", "Id_Tecnologia", "Entorno", "Fecha_migracion", "Valido", "Ultimo")
        VALUES (<1>, <2>, <3>, <4>, CURRENT_DATE, 1, 1);
    ```
    Donde `<1>` corresponde al código de pedido seleccionado.

    Donde `<2>` corresponde al código de squad seleccionado.

    Donde `<3>` corresponde al código de tecnología seleccionado.

    Donde `<4>` se capturarán de la interfaz de usuario.

## Equivalencias y Modelo DDV

### Conceptos de Negocio

---

**Código Requerimiento:** R-031

**Código Interfaz:** I-031

**Imagen Interfaz**

<div>
<img src=".\resources\prototipo\I-031.png" alt="I-031" style="width: 50%; height: auto;"/>
</div>

**Sentencias SQL**

**Eventos:**

1. **Carga de Página:**

    Se llenará la tabla:
    ```sql
    SELECT 
    d.tipo_dominio AS dominio,
    cn.subdominio,
    e.nombre_esquema AS esquema,
    dt."Tabla" AS tabla,
    dt."Campo" AS campo,
    cn."DefinicionTabla",
    cn."DefinicionCampo"
    FROM public."ConceptosNegocio" cn
    INNER JOIN public."Dominio" d ON cn.id_dominio = d.id_dominio
    INNER JOIN public."DefinicionesTecnicas" dt ON cn.id_referencia = dt."id_DT"
    INNER JOIN public."Esquema" e ON dt."EsquemaId" = e.id_esquema;

    ```
---

**Código Requerimiento:** R-032

**Código Interfaz:** I-032

**Imagen Interfaz**

<div>
<img src=".\resources\prototipo\I-032.png" alt="I-032" style="width: 50%; height: auto;"/>
</div>

**Sentencias SQL**

**Eventos:**

1. **Carga de Página:**
   
    Se llenará la lista de dominios a seleccionar:
    ```sql
    SELECT id_dominio, tipo_dominio
    FROM public.”Dominio”;
    ```

    Se llenará la lista de ambientes a seleccionar:
   ```sql
    SELECT id_ambiente, nombre_ambiente 
    FROM public."Ambiente";
    ```
    Obtener la lista desplegable de esquemas posibles, basándonos en el ambiente seleccionado:
   ```sql
    SELECT id_esquema, nombre_esquema
    FROM public."Esquema"
    WHERE "AmbienteId" =  <1>;
   ```
    Donde `<1>` corresponde al código de ambiente seleccionado previamente

2. **Botón: Agregar Campo**

   Se guardará un nuevo registro tanto en la tabla de definiciones técnicas como en conceptos     de negocio:
   
     ```sql
    INSERT INTO public."ConceptosNegocio" (
	id_dominio,
	subdominio,
     id_referencia,
     “DefinicionTabla”,
     “DefinicionCampo”,
     “PedidoId”)
     VALUES (<2>, <3>, 1, NULL, <4>, 1);
    ```
    Donde `<2>` es el código de dominio seleccionado.
   
    Donde `<3>` se capturará de la interfaz de usuario.
   
    Donde `<4>` se capturará de la interfaz de usuario.

    ```sql
    INSERT INTO public."DefinicionesTecnicas" (
    “EquivalenciaId”, 
    “ModeloId”
	“EsquemaId”, 
    “Tabla”,
    “Campo”)
    VALUES (NULL, 1, <5>, NULL, <6>);
    ```
    
    Donde `<5>`es el código del esquema seleccionado.
   
    Donde `<6>` se capturará de la interfaz de usuario.

---

**Código Requerimiento:** R-033

**Código Interfaz:** I-033

**Imagen Interfaz**

<div>
<img src=".\resources\prototipo\I-033.png" alt="I-033" style="width: 50%; height: auto;"/>
</div>

**Sentencias SQL**

**Eventos:**

1. **Carga de Página:**

   ```sql
    SELECT “Campo” FROM public.”DefinicionesTecnicas”
    WHERE  “EquivalenciaId” IS NULL;
   ```

2. **Botón Guardar:**

    Se actualizará la tabla de Definiciones Técnicas con el registro “Tabla” asociado al campo     previamente registrado:
   
    ```sql
    UPDATE public."DefinicionesTecnicas"
    SET “Tabla" = ‘<1>’
    WHERE "id_DT" = (SELECT "id_DT"
    FROM public."DefinicionesTecnicas"
    WHERE "Campo" = '<2>');
   ```
   Donde `<1>` se capturará de la interfaz de usuario

   Donde `<2>` es el valor del campo seleccionado

   Se actualizará la tabla Conceptos de Negocio con el registro de “Definición Tabla” :

     ```sql
    UPDATE public."ConceptosNegocio"
    SET "DefinicionTabla" = '<3>'
    WHERE "id_CN” = <4>;
   ```
   Donde `<3>` se capturará de la interfaz de usuario
   Donde `<4>` es el código del concepto de negocio a actualizar

### Equivalencias

---

**Código Requerimiento:** R-034

**Código Interfaz:** I-034

**Imagen Interfaz**

<div>
<img src=".\resources\prototipo\I-034.png" alt="I-034" style="width: 50%; height: auto;"/>
</div>

**Sentencias SQL**

**Eventos:**

1. **Carga de Página:**

   Se llenará la lista de tablas a seleccionar:

    ```sql
    SELECT DISTINCT "Tabla"
    FROM public."DefinicionesTecnicas"
    WHERE "EquivalenciaId" IS NULL;
   ```

2. **Botón Buscar:**

   Se llenará las tablas de esquema, tabla y campo.
   ```sql
   SELECT DISTINCT e1.nombre_esquema AS "Esquema Original",
    e2.nombre_esquema AS "Esquema Equivalente"
    FROM public."DefinicionesTecnicas" dt1
    LEFT JOIN public."DefinicionesTecnicas" dt2 ON  dt1."id_DT" = dt2."EquivalenciaId"
    LEFT JOIN public."Esquema" e1 ON dt1."EsquemaId" = e1."id_esquema"
    LEFT JOIN public."Esquema" e2 ON dt2."EsquemaId" = e2."id_esquema"
    WHERE dt1."Tabla" = '<1>';
   ```

   ```sql
   SELECT DISTINCT
       dt1."Tabla" as "Tabla Original",
       dt2."Tabla" as "Tabla Equivalente"
    FROM public."DefinicionesTecnicas" dt1
    LEFT JOIN public."DefinicionesTecnicas" dt2 ON dt1."id_DT" = dt2."EquivalenciaId"
    WHERE dt1."Tabla" = '<1>';
   ```

   ```sql
   SELECT
       dt1."Campo" as "Campo Original",
       dt2."Campo" as "Campo Equivalente"
    FROM public."DefinicionesTecnicas" dt1
    LEFT JOIN public."DefinicionesTecnicas" dt2 ON dt1."id_DT" = dt2."EquivalenciaId"
    WHERE dt1."Tabla" = '<1>';
    ```

    Donde `<1>` se capturará de la interfaz de usuario.

[Regresar al índice](Indice.md)
