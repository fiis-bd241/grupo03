# No-SQL

### Descripción de Couchbase

Couchbase es una base de datos NoSQL diseñada para ofrecer escalabilidad horizontal, alta disponibilidad y un rendimiento óptimo en entornos que manejan grandes volúmenes de datos y requieren acceso rápido a la información. Utiliza un modelo de almacenamiento de clave-valor compatible con documentos JSON, lo cual facilita la flexibilidad en la estructura de los datos y la adaptabilidad a cambios en los requisitos de la aplicación.

### Ventajas de Couchbase

1. **Escalabilidad horizontal**: Permite aumentar la capacidad de almacenamiento y procesamiento agregando más nodos al clúster, lo cual es fundamental para manejar cargas de trabajo en expansión sin comprometer el rendimiento.

2. **Alta disponibilidad y tolerancia a fallos**: Utiliza técnicas de replicación automática y particionamiento para garantizar que los datos estén siempre disponibles y protegidos contra fallos de hardware o red.

3. **Rendimiento optimizado**: Ofrece tiempos de respuesta bajos y predecibles gracias a su arquitectura optimizada para consultas rápidas y eficientes, ideal para aplicaciones que requieren acceso rápido a datos en tiempo real.

4. **Modelo de datos flexible**: Soporta almacenamiento y consulta de datos en formato JSON con la capacidad de evolucionar dinámicamente según las necesidades cambiantes de la aplicación, eliminando la rigidez de los esquemas tradicionales.

### ¿Por qué elegimos Couchbase?

- **Escalabilidad y rendimiento**: Elegimos Couchbase porque necesitamos manejar grandes volúmenes de datos con requisitos estrictos de rendimiento y disponibilidad. Couchbase ofrece una solución robusta y escalable que puede adaptarse fácilmente a nuestras necesidades en crecimiento.

- **Flexibilidad y agilidad**: Optamos por Couchbase debido a su capacidad para ajustar y evolucionar dinámicamente la estructura de nuestros datos. Esto es crucial para nuestras aplicaciones que evolucionan rápidamente y necesitan manejar datos semiestructurados de manera eficiente.

- **Similitud en la sintaxis con PostgreSQL**: Nos inclinamos por Couchbase también por la similitud en la sintaxis de consulta y manipulación de datos con PostgreSQL.

## Aplicación a Nuestro Modelo

### Iniciación


Primero, inciamos el contenedor que creamos en Docker.

<div>
<img src=".\resources\NoSQL\CB-06.jpeg" alt="CB-06" style="width: auto; height: auto;"/>
</div>

Luego, nos dirigimos a http://localhost:8091 y iniciamos sesión con las creeenciales que hemos creado, En este caso fue:

Username: Administrator     
Password: 123456

<div>
<img src=".\resources\NoSQL\CB-00.jpeg" alt="CB-00" style="width: auto; height: auto;"/>
</div>

Una vez ingresando las creencias, entramos en su pantalla principal.

<div>
<img src=".\resources\NoSQL\CB-01.jpeg" alt="CB-01" style="width: auto; height: auto;"/>
</div>

En la parte izquierda, vemos la sección "Buckets". Hacemos click e ingresamos en su pantalla.

<div>
<img src=".\resources\NoSQL\CB-02.jpeg" alt="CB-02" style="width: auto; height: auto;"/>
</div>

Hacemos clic en "Add Bucket". Configura el nombre del bucket lo cual vamos a ponerlo como BCP y ajusta otras configuraciones según sean necesarios. Escogemos que buckets sea del tipo "Couchbase" para que los datos se almacenen en memoria y en disco para que la base de datos ofrezca alta disponibilidad y replicación.

<div>
<img src=".\resources\NoSQL\CB-03.jpeg" alt="CB-03" style="width: auto; height: auto;"/>
</div>

Para poder probarlo para nuestro modelo. Se hace la subida de algunos datos que tenemos. Esto se puede hacer de dos formas: 

#### Desde la consola de Windowns: 

Se copia el archivo JSON al contenedor Docker. Donde "db" es el nombre que asignamos al contenedor que alberga el servidor de Couchbase.


```
docker cp C:\Users\Moise\Downloads\datos.json db:/
```

Se ejeecuta el siguiente comando para que se pueda ejecutar un  comando en el contenedor db.

```
docker exec -it db bash
```

Y por último, se utiliza este comando para importar datos JSON a Couchbase.

```
cbimport json --format lines -c http://127.0.0.1:8091 -u Administrator -p 123456 -b BCP -d file://datos.json -g %_id%
```

#### Desde el mismo servidor web:

En la sección "Buckets", en Buckets BCP aprarece un opción "Documnets".

<div>
<img src=".\resources\NoSQL\CB-05.jpeg" alt="CB-05" style="width: auto; height: auto;"/>
</div>

Al hacer click nos aparecerán todos los documentos cargados, pero como todavía no importamos nada, está vacío.  Allí hay opción "Import", al hacer click, nos abre una pantalla donde podemos escoger un documento para hacer la carga.

<div>
<img src=".\resources\NoSQL\CB-04.jpeg" alt="CB-04" style="width: auto; height: auto;"/>
</div>

Los datos de los documentos usados son los siguientes:

[Documentos](/Monografia/resources/NoSQL/datos.md)


### Cambios en los datos

* "Area_Direccion" a "Area_Contacto":

En la estructura SQL, se tenía solo la dirección de correo electrónico, en su lugar, se creó una lista donde se pueda incluir todas las formas de contacto que puede tener esa área de la empresa, como, por ejemplo, puede ser el teléfono.

* "Pedido_FechaLimite" como lista:

En la estructura SQL, Pedido_FechaLimite se manejaba como una fecha única. Ahora se ha convertido en una lista, lo que permite la inclusión de múltiples fechas si que hay una postergación o un adelanto de la fecha límite de un pedido.


### Uso de Querrys

Couchbase ofrece un lenguaje de consulta llamado N1QL (Non-First Normal Form Query Language), que es similar a SQL y está diseñado específicamente para trabajar con documentos JSON.

Primero, entramos a la sección de "Query".

<div>
<img src=".\resources\NoSQL\CB-07.jpeg" alt="CB-07" style="width: auto; height: auto;"/>
</div>

Ahora, haremos juntos simples de select:

```sql
SELECT * FROM `BCP` WHERE type = "area";
```
<div>
<img src=".\resources\NoSQL\CB-08.jpeg" alt="CB-08" style="width: auto; height: auto;"/>
</div>

```sql
SELECT * FROM `BCP` 
WHERE type = "pedido" AND Prioridad_Id = 1;
```

<div>
<img src=".\resources\NoSQL\CB-09.jpeg" alt="CB-09" style="width: auto; height: auto;"/>
</div>

También se puede usar join:

```sql
SELECT p.Pedido_Id, 
       a.Area_Nombre, 
       pr.Nivel,
       s.nombre_squad
FROM `BCP` AS p
JOIN `BCP` AS a ON p.Area_Id
JOIN `BCP` AS pr ON p.Prioridad_Id
JOIN `BCP` AS es ON p.Estado_Id
JOIN `BCP` AS s ON p.Id_Squad
WHERE p.type = "pedido"
  AND a.type = "area"
  AND pr.type = "prioridad"
  AND es.type = "estado"
  AND s.type = "squad"
  AND es.Estado_Tipo ="Pendiente";
  ```

<div>
<img src=".\resources\NoSQL\CB-10.jpeg" alt="CB-10" style="width: auto; height: auto;"/>
</div>

También se puede insertar nuevos documentos:

```sql
INSERT INTO `BCP` (KEY, VALUE)
VALUES ("area::22", {
"Area_Id": 22,
    "Area_Nombre": "Inovación",
    "Area_Descripcion": "Se encarga de crear un entorno óptimo para la generación, desarrollo y ejecución de ideas disruptivas.",
    "Area_Contacto": {
        "email": "inovacion@bcp.com",
        "telefono": "912345679"
    },
    "type": "area"
});
```

También se puede eliminar documentos:

```sql
DELETE FROM `BCP`
WHERE type = "pedido" AND Pedido_Id = 1;
```

También se puede actualizar los documentos:

```sql
UPDATE `BCP`
SET Area_Descripcion = "Sistema de información que permite recolectar, registrar, procesar y generar informes."
WHERE type = "area" AND Area_Nombre = "CONTABILIDAD GENERAL";
```


[Regresar al índice](Indice.md)
